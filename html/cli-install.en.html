<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>genpack-install CLI Reference</title>
<link rel="stylesheet" href="css/style.css">
<link rel="icon" href="image/favicon.png">
<meta property="og:title" content="genpack-install CLI Reference" />
<meta property="og:description" content="Complete reference of genpack-install options and operation modes" />
<meta property="og:image" content="https://www.walbrix.co.jp/genpack/image/article.png" />
<meta property="og:url" content="https://www.walbrix.co.jp/genpack/cli-install.en.html" />
<meta property="og:type" content="article" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="genpack-install CLI Reference" />
<meta name="twitter:description" content="Complete reference of genpack-install options and operation modes" />
<meta name="twitter:image" content="https://www.walbrix.co.jp/genpack/image/article.png" />
<meta name="twitter:site" content="@wbrxcorp" />
</head>
<body class="en">

<p class="last-updated">
Last updated: <time>2026-02-23</time>
</p>

<!-- content:begin -->
<h1>genpack-install CLI Reference</h1>

<h2>Overview</h2>

<p><code>genpack-install</code> is a tool for deploying SquashFS system images generated by genpack to physical disks, ISO images, and ZIP archives.</p>

<ul>
<li>GitHub: <a href="https://github.com/wbrxcorp/genpack-install">wbrxcorp/genpack-install</a></li>
</ul>

<pre><code>genpack-install [options] [system_image]</code></pre>

<p><strong>Root privileges are required.</strong></p>

<h2>Options</h2>

<h3>Positional Arguments</h3>

<table>
<thead>
<tr><th>Argument</th><th>Required</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>system_image</code></td><td>Depends on mode</td><td>System image file (SquashFS)</td></tr>
</tbody>
</table>

<p>Required in self-update mode. Optional in <code>--disk</code>, <code>--cdrom</code>, and <code>--zip</code> modes &mdash; when omitted, the currently installed system image is used.</p>

<h3>Named Options</h3>

<table>
<thead>
<tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>--disk &lt;PATH&gt;</code></td><td>String</td><td>(none)</td><td>Disk device path. Specify <code>list</code> to show installable disks</td></tr>
<tr><td><code>--cdrom &lt;PATH&gt;</code></td><td>String</td><td>(none)</td><td>Path of ISO9660 image to create</td></tr>
<tr><td><code>--zip &lt;PATH&gt;</code></td><td>String</td><td>(none)</td><td>Path of ZIP archive to create</td></tr>
<tr><td><code>--system-cfg &lt;PATH&gt;</code></td><td>Path</td><td>(none)</td><td>Install specified system.cfg file</td></tr>
<tr><td><code>--system-ini &lt;PATH&gt;</code></td><td>Path</td><td>(none)</td><td>Install specified system.ini file</td></tr>
<tr><td><code>--label &lt;NAME&gt;</code></td><td>String</td><td>(none)</td><td>Volume label for boot partition or ISO image</td></tr>
<tr><td><code>--gpt</code></td><td>Flag</td><td>false</td><td>Always use GPT instead of MBR</td></tr>
<tr><td><code>--superfloppy</code></td><td>Flag</td><td>false</td><td>Use whole disk instead of partitioning</td></tr>
<tr><td><code>--no-esp</code></td><td>Flag</td><td>false</td><td>Don&rsquo;t mark boot partition as ESP</td></tr>
<tr><td><code>--additional-boot-files &lt;PATH&gt;</code></td><td>Path</td><td>(none)</td><td>ZIP archive containing additional boot files</td></tr>
<tr><td><code>-y</code></td><td>Flag</td><td>false</td><td>Skip confirmation prompts</td></tr>
<tr><td><code>--debug</code></td><td>Flag</td><td>false</td><td>Show debug messages</td></tr>
</tbody>
</table>

<h2>Operation Modes</h2>

<p>genpack-install has 4 operation modes depending on the combination of arguments.</p>

<h3>Self-Update (arguments only, no mode options)</h3>

<pre><code>genpack-install &lt;system_image&gt;</code></pre>

<p>Atomically updates the system image of a running system. This mode is used when none of <code>--disk</code>, <code>--cdrom</code>, or <code>--zip</code> are specified.</p>

<p><strong>Update procedure:</strong></p>

<ol>
<li>Locate the current system image path (boot partition&rsquo;s <code>system.img</code> or data partition&rsquo;s <code>system</code>)</li>
<li>Validate the new system image</li>
<li>Update boot files (kernel, initramfs, bootloader)</li>
<li>Atomic rename swap:
<ul>
<li>Remove existing <code>system.old</code> (if present)</li>
<li>Copy new image as <code>system.new</code></li>
<li>Rename current image to <code>system.cur</code> (preserved for rollback)</li>
<li>Rename <code>system.new</code> to the original image path</li>
<li>Execute <code>sync</code></li>
</ul>
</li>
</ol>

<p>On failure, automatic recovery from <code>system.cur</code> is attempted.</p>

<h3>Disk Installation (--disk)</h3>

<pre><code>genpack-install --disk=&lt;device path&gt; [options] [system_image]
genpack-install --disk=list</code></pre>

<p>Installs a system image to a physical disk.</p>

<p>Specifying <code>--disk=list</code> shows a list of installable disks. Read-only devices, mounted devices, and devices smaller than 4GiB are excluded.</p>

<p><strong>Partitioning:</strong></p>

<ul>
<li><strong>Automatic MBR/GPT selection</strong>: MBR is chosen if the disk is 2TiB or smaller with 512-byte logical sectors; GPT is used otherwise</li>
<li><code>--gpt</code>: Force GPT regardless of conditions</li>
<li><code>--superfloppy</code>: No partition table; formats the entire disk as FAT32 (images under 4GiB only)</li>
</ul>

<p><strong>Normal mode (with partitioning) layout:</strong></p>

<ol>
<li><strong>Boot partition</strong> (FAT32): Stores kernel, initramfs, bootloader, and system images under 4GiB</li>
<li><strong>Data partition</strong> (Btrfs): Stores system images 4GiB or larger. Labeled <code>data-{boot partition UUID}</code></li>
</ol>

<p>Specifying <code>--no-esp</code> prevents the boot partition from being marked as ESP (EFI System Partition). Use this when certain bootloaders dislike the ESP flag (only effective with MBR).</p>

<p>A confirmation prompt is shown before installation. Use <code>-y</code> to skip.</p>

<h3>ISO Image Creation (--cdrom)</h3>

<pre><code>genpack-install --cdrom=&lt;output path&gt; [--label=&lt;label&gt;] [system_image]</code></pre>

<p>Creates a bootable ISO9660 image. Requires xorriso (libisoburn) to be installed.</p>

<ul>
<li><strong>BIOS boot</strong>: El Torito (if <code>eltorito-bios.img</code> exists)</li>
<li><strong>EFI boot</strong>: Appended EFI partition (if <code>eltorito-efi.img</code> exists)</li>
<li>When both images exist, a dual-boot ISO is generated</li>
</ul>

<p>When <code>--label</code> is omitted, the volume label defaults to <code>GENPACK</code>.</p>

<h3>ZIP Archive Creation (--zip)</h3>

<pre><code>genpack-install --zip=&lt;output path&gt; [system_image]</code></pre>

<p>Creates a ZIP archive containing the system image and boot files.</p>

<p><strong>Files included in the ZIP:</strong></p>

<ul>
<li><code>system.img</code> &mdash; System image</li>
<li><code>system.cfg</code> &mdash; System configuration (when <code>--system-cfg</code> is specified)</li>
<li><code>system.ini</code> &mdash; System configuration (when <code>--system-ini</code> is specified)</li>
<li>Raspberry Pi boot files (for Raspberry Pi images)</li>
</ul>

<h2>Bootloader</h2>

<p>genpack-install uses GRUB as the bootloader. Bootloader files are searched in the following order:</p>

<ol>
<li><code>/usr/lib/genpack-install/</code> inside the system image</li>
<li><code>/usr/local/lib/genpack-install/</code> on the host</li>
<li><code>/usr/lib/genpack-install/</code> on the host</li>
</ol>

<p><strong>Installed files:</strong></p>

<ul>
<li><strong>EFI bootloader</strong>: <code>boot*.efi</code> files are copied to <code>efi/boot/</code></li>
<li><strong>BIOS bootloader</strong>: Installed when <code>boot.img</code>, <code>core.img</code>, and <code>grub.cfg</code> exist and <code>grub-bios-setup</code> is available</li>
</ul>

<p><strong>Supported architectures:</strong></p>

<table>
<thead>
<tr><th>Architecture</th><th>BIOS</th><th>UEFI</th></tr>
</thead>
<tbody>
<tr><td>x86_64</td><td>boot.img + core.img</td><td>bootx64.efi</td></tr>
<tr><td>i386</td><td>boot.img + core.img</td><td>bootia32.efi</td></tr>
<tr><td>aarch64</td><td>&mdash;</td><td>bootaa64.efi</td></tr>
<tr><td>riscv64</td><td>&mdash;</td><td>bootriscv64.efi</td></tr>
</tbody>
</table>

<p><strong>Raspberry Pi support:</strong></p>

<p>When the system image contains <code>boot/bootcode.bin</code>, it is treated as a Raspberry Pi image. All files under the <code>boot/</code> directory are copied to the boot partition, and the <code>root=</code> parameter in <code>cmdline.txt</code> is rewritten to <code>root=systemimg:auto</code>.</p>

<p><strong>grub.cfg system.img search logic:</strong></p>

<ol>
<li>If <code>system.img</code> exists on the boot partition, use it</li>
<li>Otherwise, search for a partition labeled <code>data-{boot partition UUID}</code></li>
<li>Then search for label <code>d-{boot partition UUID}</code></li>
<li>As a last resort, infer from boot partition number (partition 1 &rarr; try partition 2)</li>
</ol>

<h2>Partition Layout</h2>

<h3>Boot Partition (FAT32)</h3>

<ul>
<li>Bootloader (GRUB EFI files, BIOS images)</li>
<li>Kernel (<code>boot/kernel</code>) and initramfs (<code>boot/initramfs</code>)</li>
<li><code>grub.cfg</code></li>
<li><code>system.cfg</code> / <code>system.ini</code> (when specified)</li>
<li><strong>System images under 4GiB</strong>: Stored as <code>system.img</code></li>
</ul>

<p>Boot partition size is <code>max(4, image_size_gib * 3 + 1)</code> GiB when the system image is under 4GiB, or 1 GiB when 4GiB or larger.</p>

<h3>Data Partition (Btrfs)</h3>

<ul>
<li>Not created when <code>--superfloppy</code> is used</li>
<li>Label: <code>data-{boot partition UUID}</code></li>
<li><strong>System images 4GiB or larger</strong>: Stored as <code>system</code></li>
</ul>

<h2>System Image Validation</h2>

<p>genpack-install validates system images before installation:</p>

<ol>
<li>A <code>.genpack/</code> directory must exist</li>
<li>One of the following must be satisfied:
<ul>
<li><code>boot/kernel</code> and <code>boot/initramfs</code> exist (standard images)</li>
<li><code>boot/bootcode.bin</code> exists (Raspberry Pi images)</li>
</ul>
</li>
</ol>

<p>Upon passing validation, the contents of <code>.genpack/artifact</code> and <code>.genpack/variant</code> are displayed.</p>

<section class="source-references">
<h2>Source References</h2>
<p>This document was written based on the following repository snapshots:</p>
<ul>
<li><a href="https://github.com/wbrxcorp/genpack-install/tree/4246185bb8c5b32f809fa482a28aa5c39caf5b3e">wbrxcorp/genpack-install @ 4246185</a></li>
</ul>
</section>
<!-- content:end -->

<section class="update-history">
<h2>Update History</h2>
<ul>
<li><time>2026-02-23</time> — Launch genpack documentation site</li>
</ul>
<p class="history-link"><a href="history.en.html">See all update history</a></p>
</section>

<nav class="doc-nav">
<h2>Other Documents</h2>
<ul>
<li><a href="index.en.html">genpack — A Gentoo-Based Immutable System Image Build Toolchain</a></li>
<li><a href="json5.en.html">genpack.json5 Specification Reference</a></li>
<li><a href="subdirectories.en.html">Artifact Directory Structure</a></li>
<li><a href="profiles.en.html">genpack-overlay Profile Reference</a></li>
<li><a href="cli.en.html">genpack CLI Reference</a></li>
<li><a href="overlay-devlauncher.en.html">genpack/devlauncher Metapackage</a></li>
<li><a href="overlay-genpack-progs.en.html">genpack/genpack-progs Package</a></li>
<li><a href="artifact-stub.en.html">stub — Multi-Distribution Installer and kexec Boot Loader for VMs</a></li>
<li><a href="uvp.en.html">A Conversation with Gemini about genpack's Unique Value Proposition</a></li>
</ul>
</nav>

</body>
</html>
